<?php include_once( "header.php"); $_SESSION[ 'error']="" ; ?><!---            <img src="img/phone_order.png"> ---><?php if($_GET['c']=="200"){ ?><script>var htmlfor='<div class="containerHead"><div class="col-md-12"> <div class="col-md-12"><strong style="color: rgb(169, 1, 1);">Sorry! Your previous ride was cacelled by driver.</strong><br></div></div></div>';jQuery("#driverdetails").html(htmlfor);jQuery("#driverdetails").show();</script><?php }?><div class="mapContainer" id="dvMap"></div><div class="buttonContainer">    <div class="buttonInnerContainer">         <button data-toggle="modal" data-target="#myModal" class="get_app" href="">GET TAXI <b>ASAP</b></button>         <p class="driver_waiting" style="display:none" href="">Please wait..! A Driver Will Contact You Shortly.</p> 		 <button  class="cancel_drive" style="display:none"  href="">Cancel</button>            </div></div><div class="modal fade" id="myModal" role="dialog">    <div class="modal-dialog formModel ">        <div class="modal-content">            <div class="modal-body">                <div class="formInnerContainer">                    <div class="taxi-icon_D"> <img class="taxi-icon" src="img/taxi-icon.png"> </div>                    <table border="0" cellpadding="4" cellspacing="2" class="web_table">                        <tr>                            <td colspan="2"><font size="12"><b>NEW ORDER<br>(pickup at:<?php echo $_SESSION['userXaddress']; ?>)</b></font>                            </td>                        </tr>                        <tr>                            <td><b>How Many People?</b>                            </td>                            <td>                                <select id="People">                                    <option value="">Select</option>                                    <option value="1" selected >1</option>                                    <option value="2">2</option>                                    <option value="3">3</option>                                    <option value="4">4</option>                                    <option value="5">5</option>                                    <option value="6">6</option>                                    <option value="7">7</option>                                    <option value="8">8</option>                                    <option value="9">9</option>                                    <option value="10">10</option>                                    <option value="11">11</option>                                    <option value="12">12</option>                                </select>                            </td>                        </tr>                        <tr>                            <td><b>Do you have a bike?</b>                            </td>                            <td>                                <select id="bike">                                    <option value="">Select</option>                                    <option value="1">Yes</option>                                    <option value="0" selected>No</option>                                </select>                            </td>                        </tr>                        <tr>                            <td><b>ADA Vehicle?</b>                            </td>                            <td>                                <select id="vehicle">                                    <option value="">Select</option>                                    <option value="1">Yes</option>                                    <option value="0" selected>No</option>                                </select>                            </td>                        </tr>                        <tr>                            <td><b>How will you Pay?</b>                            </td>                            <td>                                <select id="Pay">                                    <option value="">Select</option>                                    <option value="1"selected>Cash or Creadit</option>                                    <option value="2">Cash Only</option>                                </select>                            </td>                        </tr>                        <tr>                            <td><b>Are you ready now?</b>                            </td>                            <td>                                <select id="ready">                                    <option value="">Select</option>                                    <option value="1" selected>Yes</option>                                    <option value="0">No</option>                                </select>                            </td>                        </tr>                        <tr>                            <td>                                <input class="webButtons" data-dismiss="modal" type="button" value="Cancel">                            </td>                            <td>                                <input class="webButtons" type="button" id="submit" value="Confirm">                            </td>                        </tr>                    </table>                </div>            </div>        </div>    </div></div><div class="modal fade" id="msgPopup" role="dialog">    <div class="modal-dialog normalpops ">        <div class="modal-content">            <div class="modal-body message" style="color: white; font-weight:bold; font-size: 20px;">			<p class="msg_p" style="padding: 0;"></p>            <input class="webButtons" id="noticed" data-dismiss="modal" type="button" value="OK">            </div>        </div>    </div></div><button style="display:none" data-toggle="modal" data-target="#msgPopup" class="clicktoshowmsg" href=""></button>  <script type="text/javascript" src="http://maps.googleapis.com/maps/api/js?sensor=false"></script><script>	var userXName = "<?php echo $_SESSION['userXname']; ?>";	var userXphone = "<?php echo $_SESSION['userXphone']; ?>";	var lat="<?php echo $_SESSION['userXlat']; ?>";	var lng="<?php echo $_SESSION['userXlng']; ?>";	var iconBaseUser = '<?php echo WEB_ROOT ;?>web_order/fare.png';	var title=userXName;   	var mapOptions = {		center: new google.maps.LatLng(lat, lng),		zoom:17,        mapTypeId: google.maps.MapTypeId.ROADMAP	};	var map = new google.maps.Map(document.getElementById("dvMap"), mapOptions);	var myLatlng = new google.maps.LatLng(lat, lng);	var marker = new google.maps.Marker({			position: myLatlng,			map: map,			icon:iconBaseUser,			title:title	});	 	</script><script>jQuery(document).ready(function() {jQuery("#submit").on("click", function() {var userXId = "<?php echo $_SESSION['userXId']; ?>";var userXName = "<?php echo $_SESSION['userXname']; ?>";var userXphone = "<?php echo $_SESSION['userXphone']; ?>";var userXisTest = "<?php echo $_SESSION['userXisTest']; ?>";var lat="<?php echo $_SESSION['userXlat']; ?>";var lng="<?php echo $_SESSION['userXlng']; ?>";var People = jQuery("#People").val();var bike = jQuery("#bike").val();var vehicle = jQuery("#vehicle").val();var Pay = jQuery("#Pay").val();var ready = jQuery("#ready").val();if (People == "") {	alert("How Many People?");	jQuery("#People").css("border", "1px solid red");} else if (bike == "") {	alert("Select all fields");	jQuery("#bike").css("border", "1px solid red");} else if (vehicle == "") {	alert("Select all fields");	jQuery("#vehicle").css("border", "1px solid red");} else if (Pay == "") {	alert("Select all fields");	jQuery("#Pay").css("border", "1px solid red");} else if (ready == "") {	alert("Select all fields");	jQuery("#ready").css("border", "1px solid red");} else {jQuery.ajax({	url: "<?php echo WEB_ROOT ;?>webapp/clear_previous_web_data.php",	method: "get",	data: {		client_id: userXId	},	success: function(res) {	}});jQuery.ajax({	url: "<?php echo WEB_ROOT ;?>webapp/fare_qualifiers.php",	method: "get",	data: {	client_id: userXId,	how_many_people: People,	have_bike: bike,	ada: vehicle,	how_will_pay: Pay,	ready_now: ready,	identify:'yes'	},	success: function(data) {	var obj=jQuery.parseJSON(data);	var code= obj.response.code;    if(code=='200'){		jQuery(".get_app").hide();		jQuery(".modal-backdrop").hide();		jQuery("#myModal").hide();		jQuery(".driver_waiting").show();		jQuery(".cancel_drive").show();		var refreshId= setInterval(function(){ 			jQuery.ajax({			url: "<?php echo WEB_ROOT ;?>webapp/search_driver.php",			method: "get",			data: {			user_id: userXId,			lat: lat,			lng: lng,			fare_status:1,			is_test_user:userXisTest			},			success: function(res) {			var resobj=jQuery.parseJSON(res);			var code= resobj.response.code;			if(code=='200'){ 			clearInterval(refreshId);			var refreshId2= setInterval(function()			{ 			jQuery.ajax({			url: "<?php echo WEB_ROOT ;?>webapp/search_driver.php",			method: "get",			data: {			user_id: userXId,			lat: lat,			lng: lng,			fare_status:0,			is_test_user:1			},			success: function(res) {			var resobj=jQuery.parseJSON(res);			var code= resobj.response.code;			if(code=='305'){ 			clearInterval(refreshId2);			}			}			});			}, 5000);											var refreshId3= setInterval(function(){ 				jQuery.ajax({					url: "<?php echo WEB_ROOT ;?>webapp/client_fare_alert.php",					method: "get",					data: {					client_id: userXId							},					success: function(res) {						var resobj=jQuery.parseJSON(res);						var code= resobj.response.code;						if(code=='200'){ 							clearInterval(refreshId3);							clearInterval(refreshId2);							var driver_id= resobj.response.id;							var first_name= resobj.response.first_name;							var middle_name= resobj.response.middle_name;							var last_name= resobj.response.last_name;							var phone= resobj.response.phone;							var email= resobj.response.email;							var hack= resobj.response.hack;							var dl_number= resobj.response.dl_number;							if(dl_number==""){							dl_number="Not Available";							}							var msg=""+first_name+" in cab #"+hack+"  is in route. Please be courteous and wait for this cab. The driver has paid a fee for the opportunity to serve you. Any problems please call driver";							var htmlfor='<div class="containerHead"><div class="col-md-12"> <div class="col-md-12"><strong>Driver Name: </strong>'+first_name+' '+middle_name+' '+last_name+'&nbsp;<strong>Phone: </strong>'+phone+'&nbsp;<strong>Email: </strong>'+email+'&nbsp;<strong>DL Number: </strong>'+dl_number+'&nbsp;&nbsp;<strong style="color: rgb(169, 1, 1);">Any problems please call driver</strong><br></div></div></div>';							jQuery("#driverdetails").html(htmlfor);							jQuery("#driverdetails").show();							jQuery(".msg_p").html(msg); 							jQuery(".clicktoshowmsg").click(); 							setTimeout(function() {							jQuery("#noticed").click();							jQuery(".msg_p").html(""); 							}, 10000);							jQuery(".driver_waiting").hide();							var driver_lastlat=null;							var diver_lastlng=null;							var UserLatlng = new google.maps.LatLng(lat, lng);							var iconBaseUser = '<?php echo WEB_ROOT ;?>web_order/fare.png';							var iconBasetaxi = '<?php echo WEB_ROOT ;?>web_order/taxi.png';							var ClientMarker = new google.maps.Marker({								position: UserLatlng,								map: map,								icon:iconBaseUser,								title:userXName							});							var driverlat= resobj.response.lat;							var driverlng= resobj.response.lng;																												var driverLatlng = new google.maps.LatLng(driverlat, driverlng);							var DriverMarker = new google.maps.Marker({								position: driverLatlng,								map: map,								icon:iconBasetaxi,								title:first_name							});							var latlngbounds = new google.maps.LatLngBounds();							latlngbounds.extend(ClientMarker.position);							map.setCenter(latlngbounds.getCenter());							(function (ClientMarker, UserLatlng) {								google.maps.event.addListener(ClientMarker, "click", function (e) {									infoWindow.setContent(UserLatlng.description);									infoWindow.open(map, UserLatlng);								});							})(ClientMarker, UserLatlng);																					latlngbounds.extend(DriverMarker.position);							(function (DriverMarker, driverLatlng) {								google.maps.event.addListener(DriverMarker, "click", function (e) {									infoWindow.setContent(driverLatlng.description);									infoWindow.open(map, DriverMarker);								});							})(DriverMarker, driverLatlng);														var path = new google.maps.MVCArray();							var service = new google.maps.DirectionsService();							var poly = new google.maps.Polyline({ map: map, strokeColor: '#4986E7' });		 							var src = UserLatlng;							var des = driverLatlng;							path.push(src);							poly.setPath(path);							service.route({							origin: src,							destination: des,							travelMode: google.maps.DirectionsTravelMode.DRIVING							}, function (result, status) {							if (status == google.maps.DirectionsStatus.OK) {								for (var i = 0, len = result.routes[0].overview_path.length; i < len; i++) {									path.push(result.routes[0].overview_path[i]);								}							}							});																		var refreshId6= setInterval(function(){   								jQuery.ajax({									url: "<?php echo WEB_ROOT ;?>webapp/getlatlng.php",									method: "get",									data: {									user_id: driver_id,									user_type: 'driver'									},									success: function(res) {										var resobj=jQuery.parseJSON(res);										var code= resobj.response.code;										if(code=='200'){ 											var driverlat= resobj.response.lat;											var driverlng= resobj.response.lng;											if(driver_lastlat!=driverlat || diver_lastlng!=driverlng){                                               var drivermarkers = [													{																												"lat": driver_lastlat,														"lng": driverlng																																									}																							];																					   											   drivermarkers[0].setMap(null);											  markersInfoArray.pop();											   driver_lastlat=driverlat;												diver_lastlng=driverlng;																								var UserLatlng = new google.maps.LatLng(lat, lng);												var iconBaseUser = '<?php echo WEB_ROOT ;?>web_order/fare.png';												var iconBasetaxi = '<?php echo WEB_ROOT ;?>web_order/taxi.png';																								var ClientMarker = new google.maps.Marker({													position: UserLatlng,													map: map,													icon:iconBaseUser,													title:userXName												});																								var driverLatlng = new google.maps.LatLng(driverlat, driverlng);												var DriverMarker = new google.maps.Marker({													position: driverLatlng,													map: map,													icon:iconBasetaxi,													title:first_name												});																								var latlngbounds = new google.maps.LatLngBounds();												latlngbounds.extend(ClientMarker.position);												map.setCenter(latlngbounds.getCenter());																								var path = new google.maps.MVCArray();												var service = new google.maps.DirectionsService();												var poly = new google.maps.Polyline({ map: map, strokeColor: '#4986E7' });		 												var src = UserLatlng;												var des = driverLatlng;												path.push(src);												poly.setPath(path);												service.route({												origin: src,												destination: des,												travelMode: google.maps.DirectionsTravelMode.DRIVING												}, function (result, status) {												if (status == google.maps.DirectionsStatus.OK) {													for (var i = 0, len = result.routes[0].overview_path.length; i < len; i++) {														path.push(result.routes[0].overview_path[i]);													}												}												});																						}										}									}								});								}, 5000);							var refreshId4= setInterval(function()							{ 							jQuery.ajax({							url: "<?php echo WEB_ROOT ;?>webapp/cancel_by_driver_for_web.php",							method: "get",							data: {							client_id: userXId,							driver_id: driver_id,							},							success: function(res) {							var resobj=jQuery.parseJSON(res);							var code= resobj.response.code;							if(code=='200'){							clearInterval(refreshId4); 							jQuery(".msg_p").html("Your drive cacelled"); 							jQuery(".clicktoshowmsg").click(); 							setTimeout(function() {							jQuery("#noticed").click();							jQuery(".msg_p").html("");							window.location="home.php?c=200"; 							}, 10000);							}							}							});							}, 5000);						}					}				});			}, 5000);			}			}			});		}, 5000);		}else{alert("Unkown Error ! Please try again later.");}}});}})});</script></body></html>